<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Board List</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/list.css}">
</head>
<body>
<!-- 헤더 포함 -->
<div th:replace="~{/layout/header :: header}"></div>

<div class="content">
    <div class="board-title">게시판 목록</div>

    <div class="sorting-options">
        <input type="radio" id="sort-newest" name="sort-option" value="newest" checked>
        <label for="sort-newest">최신순</label>

        <input type="radio" id="sort-oldest" name="sort-option" value="oldest">
        <label for="sort-oldest">오래된 순</label>

        <input type="radio" id="sort-views" name="sort-option" value="views">
        <label for="sort-views">조회순</label>
    </div>

    <div class="write-button-container">
        <a th:href="@{/board/write}" class="btn-write" sec:authorize="isAuthenticated()">글 작성</a>
    </div>
    <table class="board-table">
        <thead>
        <tr>
            <th class="number">번호</th>
            <th class="title">제목</th>
            <th class="writer">작성자</th>
            <th class="views">조회수</th>
            <th class="date">작성일</th>
        </tr>
        </thead>
        <tbody>
            <tr th:each="board : ${boards}">
                <td th:text="${board.boardId}"></td>
                <td>
                    <a th:href="@{/board/detail/{boardId}(boardId=${board.boardId})}"
                       th:text="${board.boardTitle} + (${board.fileCount} > 0 ? ' [첨부파일:' + ${board.fileCount} + ']' : '')"></a>
                </td>
                <td th:text="${board.name}"></td>
                <td th:text="${board.boardViews}"></td>
                <td>
                    <span th:if="${board.boardRegisterDate == board.boardUpdateDate}"
                          th:text="${#temporals.format(board.boardRegisterDate, 'yy년 M월 d일 HH시 mm분')}"></span>
                    <span th:if="${board.boardRegisterDate != board.boardUpdateDate}"
                          th:text="${#temporals.format(board.boardUpdateDate, 'yy년 M월 d일 HH시 mm분') + ' (수정)'}"></span>
                </td>
            </tr>
        </tbody>
    </table>
    <ul class="pagination">
        <!-- Previous group button -->
        <li th:classappend="${startPage == 1} ? 'disabled' : ''" class="page-item">
            <a class="page-link" th:href="@{/board/list(page=${startPage - 1}, pageSize=${pageSize})}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>

        <!-- Page numbers -->
        <li th:each="i : ${#numbers.sequence(startPage, endPage)}" th:classappend="${currentPage == i} ? 'active' : ''" class="page-item">
            <a class="page-link" th:href="@{/board/list(page=${i}, pageSize=${pageSize})}" th:text="${i}"></a>
        </li>

        <!-- Next group button -->
        <li th:classappend="${endPage == totalPages} ? 'disabled' : ''" class="page-item">
            <a class="page-link" th:href="@{/board/list(page=${endPage + 1}, pageSize=${pageSize})}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</div>

<!-- 푸터 포함 -->
<div  class="footer" style="position: fixed; bottom: 0">
    <div class="footer" th:replace="~{/layout/footer :: footer}"></div>
</div>
</body>

<script>
    // 정렬 옵션에 따라 게시글 목록을 가져오는 AJAX 요청
    function fetchSortedPosts(sortOption) {
        $.ajax({
            type: 'GET',
            url: '/api/board/sorted-list', // 실제 요청을 처리할 서버의 API 엔드포인트로 변경해야 합니다.
            data: { sort: sortOption },
            success: function(response) {
                console.log(response);
                renderPosts(response);
            },
            error: function(xhr, status, error) {
                console.error('게시글 목록을 가져오는 데 실패했습니다.', error);
                // 에러 처리 로직을 구현합니다.
            }
        });
    }

    // 라디오 버튼 변경 이벤트 리스너
    $('input[name="sort-option"]').change(function() {
        var selectedOption = $(this).val();
        fetchSortedPosts(selectedOption); // 변경된 옵션을 인자로 AJAX 함수 호출
    });

    function renderPosts(posts) {
        const postsContainer = $('.table tbody');
        postsContainer.empty(); // 기존 목록을 비웁니다.

        posts.forEach(function(post) {
            // 첨부파일이 0개가 아니면 파일 개수를 보여주는 문자열을 생성하고, 아니면 빈 문자열을 사용합니다.
            const fileCountString = post.fileCount > 0 ? ` [첨부파일:${post.fileCount}]` : '';

            const postRow = `
        <tr>
            <td class="checkbox">
                <label>
                    <input type="checkbox" name="board" value="${post.boardId}">
                </label>
            </td>
            <td class="number">${post.boardId}</td>
            <td class="title"><a href="/board/detail/${post.boardId}">${post.boardTitle}${fileCountString}</a></td>
            <td class="author">${post.name}</td>
            <td class="views">${post.boardViews}</td>
<!--            만질 필요가 있다. -->
            <td class="date">${formatDate(post.boardRegisterDate)}${post.boardRegisterDate !== post.boardUpdateDate ? ' (수정)' : ''}</td>
        </tr>
    `;
            postsContainer.append(postRow); // 게시글 행을 목록에 추가합니다.
        });
    }




</script>

</html>
